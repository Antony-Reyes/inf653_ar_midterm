# Set the ServerName to prevent Apache warnings
ServerName localhost

# Define the document root
DocumentRoot /var/www/html

# Configure directory permissions
<Directory /var/www/html>
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    DirectoryIndex index.php index.html
</Directory>

# API-Specific Configuration
<Directory /var/www/html/api>
    Options -Indexes +FollowSymLinks
    AllowOverride All
    Require all granted
    DirectoryIndex index.php
</Directory>

# Ensure PHP files are processed in API directory
<FilesMatch "\.php$">
    SetHandler application/x-httpd-php
</FilesMatch>

# Enable mod_rewrite for API URLs
<IfModule mod_rewrite.c>
    RewriteEngine On

    # Redirect /api/quotes/ to /api/quotes/index.php
    RewriteCond %{REQUEST_URI} ^/api/quotes/$
    RewriteRule ^(.*)$ /api/quotes/index.php [L,QSA]

    # Redirect /api/authors/ to /api/authors/index.php
    RewriteCond %{REQUEST_URI} ^/api/authors/$
    RewriteRule ^(.*)$ /api/authors/index.php [L,QSA]

    # Redirect /api/categories/ to /api/categories/index.php
    RewriteCond %{REQUEST_URI} ^/api/categories/$
    RewriteRule ^(.*)$ /api/categories/index.php [L,QSA]

    # General rule to route API calls to the correct PHP file
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^api/(.+)/?$ api/$1/index.php [L,QSA]
</IfModule>

# Set default JSON response headers
<IfModule mod_headers.c>
    Header always set Content-Type "application/json; charset=UTF-8"
    Header always set Access-Control-Allow-Origin "*"
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set X-Content-Type-Options "nosniff"
</IfModule>

# Log file locations
ErrorLog ${APACHE_LOG_DIR}/error.log
CustomLog ${APACHE_LOG_DIR}/access.log combined

# Increase request limits for API handling
<IfModule mod_php.c>
    php_value upload_max_filesize 64M
    php_value post_max_size 64M
    php_value max_execution_time 300
    php_value memory_limit 256M
</IfModule>
